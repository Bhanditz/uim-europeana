<?xml version="1.0" encoding="UTF-8"?>
<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
		   xmlns:bp="http://www.osgi.org/xmlns/blueprint/v1.0.0"
		   xmlns:shell="http://karaf.apache.org/xmlns/shell/v1.0.0">
		   
	<service id="registry" ref="uimRegistry" interface="eu.europeana.uim.api.Registry"/>

    <bean id="uimRegistry" class="eu.europeana.uim.UIMRegistry" />

	<reference id="orchestrator" interface="eu.europeana.uim.api.Orchestrator" availability="optional"/>

	<reference-list interface="eu.europeana.uim.api.IngestionPlugin" availability="optional">
		<reference-listener 
              bind-method="addPlugin" unbind-method="removePlugin" ref="uimRegistry">
      	</reference-listener>
	</reference-list>
	
	<reference-list interface="eu.europeana.uim.api.StorageEngine" availability="optional">
		<reference-listener 
              bind-method="addStorage" unbind-method="removeStorage" ref="uimRegistry">
      	</reference-listener>
	</reference-list>

	<reference-list interface="eu.europeana.uim.api.Workflow" availability="optional">
		<reference-listener 
              bind-method="addWorkflow" unbind-method="removeWorkflow" ref="uimRegistry">
      	</reference-listener>
	</reference-list>

    <shell:command-bundle>
        <shell:command name="uim/info">
            <shell:action class="eu.europeana.uim.command.UIMInfo">
                <shell:argument ref="uimRegistry" />
            </shell:action>
        </shell:command>
        <shell:command name="uim/store">
            <shell:action class="eu.europeana.uim.command.UIMStore">
                <shell:argument ref="uimRegistry" />
            </shell:action>
        </shell:command>
        <shell:command name="uim/orchestrator">
            <shell:action class="eu.europeana.uim.command.UIMOrchestratorCommand">
                <shell:argument ref="uimRegistry" />
                <shell:argument ref="orchestrator" />
            </shell:action>
        </shell:command>
    </shell:command-bundle>

    <shell:command-bundle>
        <shell:command name="uimconfig/storage">
            <shell:action class="eu.europeana.uim.command.UIMConfigStorage">
                <shell:argument ref="uimRegistry" />
            </shell:action>
        </shell:command>
    </shell:command-bundle>

</blueprint>
